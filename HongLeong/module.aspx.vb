Imports System.IO
Imports System.Data
Imports System.Data.SqlClient
Imports System.Data.OleDb
Imports System.Web
Imports System.Web.UI
Imports System.Web.UI.WebControls
Partial Public Class module_class

    Inherits detailspage

    Private f_size As String
    'Generated by VI FEANDI SOFTLABS FORM GENERATOR (http://www.vifeandi.net) VER 2014.1
    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        listingpage = "modlist.aspx&ga=" & catid.Value & "&la=" & deptid.Value
        _FormsName = "Module Details"
        TableName = "module"
        IDPField = ""
        IDField = "mod_id"
        AppIDField = ""
        MerchantIDField = ""
        FilterField = "mod_filter"
        APPCode = ""
        AddRights = "" '"SM0001"
        DelRights = "" '"SM0003"
        ModRights = "" '"SM0002"
        ViewRights = "" '"SM0004"
        FullRights = ""
        NmSpace = "mstrcategory"

        Dim obj As New ViFeandi.General
        f_size = obj.GetPageSizeString(True, "")
        obj = Nothing

        BackButton.Visible = True

        If Page.IsPostBack = False Then

            catid.Value = Request("la") & ""
            deptid.Value = Request("da") & ""

        End If

        Call InitLoad()

    End Sub
    Private Function ValidateForm()
        lblMessage.Text = ""
        If mod_code.Text.Trim = "" Then
            lblMessage.Text = WebLib.getAlertMessageStyle("Module Code is Mandatory")
            Return False
            Exit Function
        End If

        If mod_description.Text.Trim = "" Then
            lblMessage.Text = WebLib.getAlertMessageStyle("Module Description is Mandatory")
            Return False
            Exit Function
        End If

        If WebLib.CodeExists(mod_code.Text, "mod_code", TableName, IDField, rid.Value, IDPField, bid.Value, AppIDField, MerchantIDField, FilterField) = True Then
            lblMessage.Text = "This Module Code Already Exist"
            Return False
            Exit Function
        End If



        Return True
    End Function
    Public Overrides Function LoadData() As Boolean
        Dim cn As New OleDbConnection(connectionstring)
        Dim cmd As New OleDbCommand()
        Dim ad As New OleDb.OleDbDataAdapter()
        Dim ds As New DataSet()
        Dim counter As Integer = 0
        Dim dr As DataRow
        Dim templi As ListItem
        If IsNumeric(rid.Value) = False Then
            Exit Function
        End If

        Try
            cmd.CommandText = "Select * from module where mod_id=" & rid.Value
            cmd.Connection = cn
            ad.SelectCommand = cmd
            ad.Fill(ds, "datarecords")
            For Each dr In ds.Tables("datarecords").Rows

                counter = counter + 1

                mod_code.Text = dr("mod_code") & ""
                mod_description.Text = dr("mod_description") & ""

                'templi = wf_classification.Items.FindByValue(dr("wf_classification") & "")
                'wf_classification.SelectedIndex = wf_classification.Items.IndexOf(templi)

                Exit For
            Next
            cn.Close()
            cmd.Dispose()
            cn.Dispose()

            Return True

        Catch ex As Exception
            lblMessage.Text = WebLib.getAlertMessageStyle(ex.Message)
            Return False
        End Try
    End Function

    Public Sub savepage(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim insertfields, insertvalues As String
        Dim lsrdesc As String = ""
        insertfields = ""
        insertvalues = ""
        If ValidateForm() = False Then
            Exit Sub
        End If

        Dim lwf_class As String = ""
        'If wf_classification.SelectedIndex < 0 Then
        '    lwf_class = ""
        'Else
        '    lwf_class = wf_classification.SelectedItem.Value
        'End If

        Try
            If rid.Value = "" Then
                uid.Value = WebLib.getUniqueKey

                insertfields = insertfields & "mod_merchantid"
                insertvalues = insertvalues & "'" & WebLib.MerchantID.replace("'", "''") & "'"
                insertfields = insertfields & ",mod_filter"
                insertvalues = insertvalues & ",'" & WebLib.FilterCode.replace("'", "''") & "'"
                insertfields = insertfields & ",mod_uid"
                insertvalues = insertvalues & ",'" & uid.Value & "'"
                insertfields = insertfields & ",mod_code"
                insertvalues = insertvalues & ",'" & mod_code.Text.Replace("'", "''") & "'"
                insertfields = insertfields & ",mod_description"
                insertvalues = insertvalues & ",'" & mod_description.Text.Replace("'", "''") & "'"
                insertfields = insertfields & ",mod_catid"
                insertvalues = insertvalues & ",'" & catid.Value.Replace("'", "''") & "'"
                insertfields = insertfields & ",mod_deptid"
                insertvalues = insertvalues & ",'" & deptid.Value.Replace("'", "''") & "'"
                insertfields = insertfields & ",mod_createby"
                insertvalues = insertvalues & ",'" & WebLib.LoginUser.replace("'", "''") & "'"
                insertfields = insertfields & ",mod_createdt"
                insertvalues = insertvalues & ",getdate()"
                insertfields = insertfields & ",mod_updateby"
                insertvalues = insertvalues & ",'" & WebLib.LoginUser.replace("'", "''") & "'"
                insertfields = insertfields & ",mod_updatedt"
                insertvalues = insertvalues & ",getdate()"

            Else
                insertvalues = insertvalues & "mod_description='" & mod_description.Text.Replace("'", "''") & "'"
                insertvalues = insertvalues & ",mod_code='" & mod_code.Text.Replace("'", "''") & "'"
                'insertvalues = insertvalues & ",wf_classification='" & lwf_class.Replace("'", "''") & "'"
                insertvalues = insertvalues & ",mod_updateby='" & WebLib.LoginUser.replace("'", "''") & "'"
                insertvalues = insertvalues & ",mod_updatedt=getdate()"

            End If

            If savedata(insertfields, insertvalues) = True Then
                'Call gotoback()
                Response.Redirect("modlist.aspx?ga=" & catid.Value & "&la=" & deptid.Value)
            End If
        Catch Err As Exception
            lblMessage.Text = WebLib.getAlertMessageStyle(Err.Message)
            LogtheAudit(Err.Message)
        Finally

        End Try
    End Sub

    'Public Sub viewModule()

    '    Response.Redirect("postpage.aspx?NextPage=" & WebLib.ClientURL("printviewer/printcr.aspx") & "&ga=" & TableName & "&la=" & uid.Value & "")

    'End Sub
    Public Sub gotobackpage(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Response.Redirect("postpage.aspx?NextPage=" & WebLib.ClientURL("modlist.aspx") & "&la=" & deptid.Value & "&ga=" & catid.Value)
    End Sub

End Class

