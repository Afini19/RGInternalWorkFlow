Imports System.IO
Imports System.Data
Imports System.Data.SqlClient
Imports System.Data.OleDb
Imports System.Web
Imports System.Web.UI
Imports System.Web.UI.WebControls
Partial Public Class edocstate_class
Inherits detailspage
Private fedoc_type as string = "Statement;;Payment Listing"

'Generated by VI SOFTLABS FORM GENERATOR (http://www.vifeandi.net) VER 2014.1
Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
listingpage = "edocStatelist.aspx"
_FormsName = "eDocument : Statement"
TableName = "edocstate"
IDPField = ""
IDField = "edoc_id"
APPIDField = ""
MerchantIDField = "edoc_merchantid"
FilterField = "sy_filter"
If Page.IsPostBack = False Then
Call WebLib.SetListItems(edoc_type,fedoc_type)

End If
Call initLoad()
End Sub
Private Function ValidateForm()
lblmessage.text = ""
If edoc_year.text.trim = "" Then
lblmessage.text = "Year is Mandatory"
Return False
Exit Function
End If
If weblib.MerchantID.trim = "" Then
lblmessage.text = "Merchant ID is Mandatory"
Return False
Exit Function
End If
If edoc_month.text.trim = "" Then
lblmessage.text = "Month is Mandatory"
Return False
Exit Function
End If
If edoc_type.selectedindex < 0 Then
lblmessage.text = "Document Type is Mandatory"
Return False
Exit Function
End If


Return True
End Function
Public Overrides Function LoadData() As Boolean
Dim cn As New OleDbConnection(connectionstring)
Dim cmd As New OleDbCommand()
Dim ad As New OleDb.OleDbDataAdapter()
Dim ds As New DataSet()
Dim counter As Integer = 0
Dim dr As DataRow
Dim templi As listitem
If isnumeric(rid.value) = False Then
Exit Function
End If

Try 
cmd.CommandText = "Select * from edocstate where edoc_id=" & rid.value
cmd.Connection = cn
ad.SelectCommand = cmd
ad.Fill(ds, "datarecords")
For Each dr In ds.Tables("datarecords").Rows
counter = counter + 1
edoc_year.text = dr("edoc_year") & ""
edoc_month.text = dr("edoc_month") & ""
edoc_branch.text = dr("edoc_branch") & ""
templi = edoc_type.Items.FindByValue(dr("edoc_type") & "")
edoc_type.SelectedIndex = edoc_type.Items.IndexOf(templi)
litcreateby.text = dr("edoc_createby") & ""
litcreateon.text = dr("edoc_createdt") & ""
litupdateby.text = dr("edoc_updateby") & ""
litupdateon.text = dr("edoc_updatedt") & ""

Exit For
Next
cn.Close()
cmd.Dispose()
cn.Dispose()
Catch ex As Exception
lblmessage.text = ex.Message
 End Try
End Function
Public Sub savepage(ByVal sender As System.Object, ByVal e As System.EventArgs)
Dim insertfields, insertvalues As String
insertfields = ""
insertvalues = ""
If ValidateForm() = False Then
Exit Sub
End If
Dim ledoc_type As String = ""
If edoc_type.selectedindex < 0 Then
ledoc_type = ""
Else
ledoc_type = edoc_type.SelectedItem.Value
End If

Try
If rid.value = "" Then
insertfields = insertfields & "edoc_year"
insertvalues = insertvalues & "'" & edoc_year.text.replace("'", "''") & "'"
insertfields = insertfields & ",edoc_merchantid"
insertvalues = insertvalues & ",'" & weblib.MerchantID.replace("'", "''") & "'"
insertfields = insertfields & ",sy_filter"
insertvalues = insertvalues & ",'" & weblib.FilterCode.replace("'", "''") & "'"
insertfields = insertfields & ",edoc_month"
insertvalues = insertvalues & ",'" & edoc_month.text.replace("'", "''") & "'"
insertfields = insertfields & ",edoc_branch"
insertvalues = insertvalues & ",'" & edoc_branch.text.replace("'", "''") & "'"
insertfields = insertfields & ",edoc_type"
insertvalues = insertvalues & ",'" & ledoc_type & "'"
insertfields = insertfields & ",edoc_createby"
insertvalues = insertvalues & ",'" & weblib.LoginUser.replace("'", "''") & "'"
insertfields = insertfields & ",edoc_createdt"
insertvalues = insertvalues & ",getdate()"
insertfields = insertfields & ",edoc_updateby"
insertvalues = insertvalues & ",'" & weblib.LoginUser.replace("'", "''") & "'"
insertfields = insertfields & ",edoc_updatedt"
insertvalues = insertvalues & ",getdate()"

else
insertvalues = insertvalues & "edoc_year='" & edoc_year.text.replace("'", "''") & "'"
insertvalues = insertvalues & ",edoc_month='" & edoc_month.text.replace("'", "''") & "'"
insertvalues = insertvalues & ",edoc_branch='" & edoc_branch.text.replace("'", "''") & "'"
insertvalues = insertvalues & ",edoc_type='" & ledoc_type & "'"
insertvalues = insertvalues & ",edoc_updateby='" & weblib.LoginUser.replace("'", "''") & "'"
insertvalues = insertvalues & ",edoc_updatedt=getdate()"

End If

If savedata(insertfields, insertvalues) = True Then
Call gotoback()
End if
Catch Err As Exception
lblmessage.text = Err.message
Finally

End Try
 End Sub
 End Class

