Imports System.IO
Imports System.Data
Imports System.Data.SqlClient
Imports System.Data.OleDb
Imports System.Web
Imports System.Web.UI
Imports System.Web.UI.WebControls
Partial Public Class wflowtag_class
    Inherits detailspage
    Private pDropDownValue As String = ""

    'Generated by VI FEANDI SOFTLABS FORM GENERATOR (http://www.vifeandi.net) VER 2014.1
    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        listingpage = ""
        _FormsName = "Asssign workflow to form"
        TableName = "[workflowlink]"
        IDPField = ""
        IDField = "wfl_id"
        AppIDField = ""
        MerchantIDField = ""
        FilterField = ""
        APPCode = ""
        AddRights = "" '"SM0001"
        DelRights = "" '"SM0003"
        ModRights = "" '"SM0002"
        ViewRights = "" '"SM0004"
        FullRights = ""
        NmSpace = "wflowtag_class"

        pDropDownValue = ViFeandi.General.setListItemsTableGetListString("wf_name", "wf_id", "Select * from workflow order by wf_name", connectionstring, True, "")

        If Page.IsPostBack = False Then

        End If
        Call InitLoad()
        BackButton.Visible = False


    End Sub
    Private Function ValidateForm()
        lblmessage.Text = ""

        Return True
    End Function
    Private Sub loadrep1()
        Dim cn As New OleDbConnection(connectionstring)

        Dim cmd As New OleDbCommand()
        Dim ad As New OleDb.OleDbDataAdapter()
        Dim ds As New DataSet()
        Dim counter As Integer = 0
        Dim dr As DataRow


        cn.Open()
        cmd.CommandText = "Select * from workflowlink order by wfl_name asc"
        cmd.Connection = cn
        ad.SelectCommand = cmd
        ad.Fill(ds, "datarecords")

        Dim dt As DataTable = ds.Tables("datarecords")
        Dim dv As New DataView(dt)

        Dim pgitems As New PagedDataSource()
        pgitems.DataSource = dv

        rep.DataSource = pgitems
        rep.DataBind()

    End Sub


    Public Overrides Function LoadData() As Boolean
       
        Call loadrep1()
    End Function
    Public Sub backback(ByVal sender As System.Object, ByVal e As System.EventArgs)

    End Sub
    Protected Sub rep_ItemDataBound(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.RepeaterItemEventArgs) Handles rep.ItemDataBound
        Dim drv As DataRowView
        drv = e.Item.DataItem
        Dim templi As ListItem

        Dim obj As Object = e.Item.FindControl("wfl_wflow")
        If Not obj Is Nothing Then
            ViFeandi.General.SetListItems(obj, pDropDownValue)

            templi = obj.Items.FindByValue(drv.Row("wfl_wflowid").ToString & "")
            obj.SelectedIndex = obj.Items.IndexOf(templi)


        End If


    End Sub

    Public Sub savepage(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim insertfields, insertvalues As String

        insertfields = ""
        insertvalues = ""
        If ValidateForm() = False Then
            Exit Sub
        End If

        Dim myObject As Object
        Dim myObjectd As DropDownList
        Dim lworkflowid As String
        Dim item As RepeaterItem
        Dim lSQL As String = ""
        Dim lid As String = 0
        Dim cn As New OleDbConnection(connectionstring)
        Dim cmd As New OleDbCommand()

        cn.Open()
        cmd.Connection = cn

        Dim lseq As Integer = 0
        lSQL = ""
        For Each item In rep.Items

            myObject = item.FindControl("uid")
            If Not myObject Is Nothing Then
                lid = myObject.Value
            End If
            lworkflowid = 0
            myObjectd = item.FindControl("wfl_wflow")
            If Not myObjectd Is Nothing Then
                If myObjectd.SelectedIndex >= 0 Then
                    lworkflowid = myObjectd.SelectedValue
                Else
                    lworkflowid = 0
                End If
            End If
            If IsNumeric(lid) = False Then
                lid = 0
            End If

            If IsNumeric(lworkflowid) = False Then
                lworkflowid = 0
            End If
            lSQL = "Update workflowlink set wfl_wflowid=" & lworkflowid & " where wfl_id=" & lid
            cmd.CommandText = lSQL
            cmd.ExecuteNonQuery()
            'Response.Write(lSQL)
        Next
        cn.Close()

        lblMessage.Text = WebLib.getAlertMessageStyle("Save Successful")

    End Sub

End Class

