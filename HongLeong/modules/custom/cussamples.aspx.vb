Imports System.IO
Imports System.Data
Imports System.Data.SqlClient
Imports System.Data.OleDb
Imports System.Web
Imports System.Web.UI
Imports System.Web.UI.WebControls
Partial Public Class cussamples_class
    Inherits detailspage
    Private FORMCODE As String = "SAMPLES"  'Hardcoded for customised form
    Private f_size As String
    'Generated by VI FEANDI SOFTLABS FORM GENERATOR (http://www.vifeandi.net) VER 2014.1
    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load

        listingpage = "wlist.aspx"
        _FormsName = "Sample Request Form"
        TableName = "[zcustom_samples]"
        IDPField = ""
        IDField = "cus_id"
        AppIDField = ""
        MerchantIDField = "cus_merchantid"
        FilterField = "cus_filter"
        APPCode = ""
        AddRights = "" '"SM0001"
        DelRights = "" '"SM0003"
        ModRights = "" '"SM0002"
        ViewRights = "" '"SM0004"
        FullRights = ""
        NmSpace = "zcustom_samples"

        If Page.IsPostBack = False Then
            cus_refno.Text = Request("rc") & ""
        End If
        cus_refno.ReadOnly = True
        Call InitLoad()

        wfb_bar.parentobj = middlepanel100p
    End Sub
    Private Function ValidateForm()
        lblmessage.Text = ""

        Return True
    End Function
    Public Sub backpagepage(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Response.Redirect(WebLib.ClientURL(redirector.PrevURL1))
    End Sub

    Public Sub SetFieldRights()

        Call wfb_bar.EnableDisable(middlepanel100p)
        Exit Sub

    End Sub

    Public Overrides Function LoadData() As Boolean
        Dim cn As New OleDbConnection(connectionstring)
        Dim cmd As New OleDbCommand()
        Dim ad As New OleDb.OleDbDataAdapter()
        Dim ds As New DataSet()
        Dim counter As Integer = 0
        Dim dr As DataRow
        Dim templi As ListItem
        If IsNumeric(rid.Value) = False Then
            wfb_bar.uid = ""
            Call SetFieldRights()
            Exit Function
        End If

        Try
            cmd.CommandText = "Select * from zcustom_samples where cus_id=" & rid.Value
            cmd.Connection = cn
            ad.SelectCommand = cmd
            ad.Fill(ds, "datarecords")
            For Each dr In ds.Tables("datarecords").Rows

                counter = counter + 1
                cus_company.Text = dr("cus_company") & ""
                cus_name.Text = dr("cus_name") & ""
                cus_salesexec.Text = dr("cus_salesexec") & ""
                cus_contactno.Text = dr("cus_contactno") & ""
                cus_email.Text = dr("cus_email") & ""
                cus_address.Text = dr("cus_address") & ""
                cus_typeofsample.Text = dr("cus_typeofsample") & ""
                cus_amount.Text = dr("cus_amount") & ""
                cus_typeoftest.Text = dr("cus_typeoftest") & ""
                cus_duration.Text = dr("cus_duration") & ""
                cus_remarks.Text = dr("cus_remarks") & ""
                cus_refno.Text = dr("cus_refno") & ""

                ucode.Value = dr("cus_ucode") & ""
                wfb_bar.uid = ucode.Value
                'Assign UCtrlHere
                Exit For
            Next
            cn.Close()
            cmd.Dispose()
            cn.Dispose()
            If wfb_bar.Workflowended = True Then
                btnsave.enabled = False
            Else
                btnsave.enabled = True
            End If

            Call SetFieldRights()




        Catch ex As Exception
            lblmessage.Text = WebLib.getAlertMessageStyle(ex.Message)
        End Try
    End Function

    Public Sub savepage(ByVal sender As System.Object, ByVal e As System.EventArgs)

        Dim insertfields, insertvalues As String
        Dim lsrdesc As String = ""
        Dim lsql As String = ""
        insertfields = ""
        insertvalues = ""
        If ValidateForm() = False Then
            Exit Sub
        End If

        Try
            If rid.Value = "" Then
                ucode.Value = WebLib.getUniqueKey
                Dim lID As String
                'lID = WebLib.GetValue("Workflow", "wf_id", "wf_code", "'" & FORMCODE & "'", "wf_merchantid", "wf_filter")
                lID = WebLib.GetValue("Workflowlink", "wfl_wflowid", "wfl_subcode", "'" & FORMCODE & "'", "", "")

                If IsNumeric(lID) = False Or (lID & "").Trim = "0" Then
                    lblmessage.Text = WebLib.getAlertMessageStyle("No Workflow Assign for this form")
                    Exit Sub
                End If

                lsql = wfb_bar.GetWorkFlowSaveSQL(lID, ucode.Value, True, cus_refno.Text, NmSpace, "Sample Request Form")


                insertfields = insertfields & "cus_merchantid"
                insertvalues = insertvalues & "'" & WebLib.MerchantID.replace("'", "''") & "'"
                insertfields = insertfields & ",cus_filter"
                insertvalues = insertvalues & ",'" & WebLib.FilterCode.replace("'", "''") & "'"
                insertfields = insertfields & ",cus_ucode"
                insertvalues = insertvalues & ",'" & ucode.Value & "'"
                insertfields = insertfields & ",cus_company"
                insertvalues = insertvalues & ",'" & cus_company.Text.Replace("'", "''") & "'"
                insertfields = insertfields & ",cus_name"
                insertvalues = insertvalues & ",'" & cus_name.Text.Replace("'", "''") & "'"
                insertfields = insertfields & ",cus_salesexec"
                insertvalues = insertvalues & ",'" & cus_salesexec.Text.Replace("'", "''") & "'"
                insertfields = insertfields & ",cus_contactno"
                insertvalues = insertvalues & ",'" & cus_contactno.Text.Replace("'", "''") & "'"
                insertfields = insertfields & ",cus_email"
                insertvalues = insertvalues & ",'" & cus_email.Text.Replace("'", "''") & "'"
                insertfields = insertfields & ",cus_address"
                insertvalues = insertvalues & ",'" & cus_address.Text.Replace("'", "''") & "'"
                insertfields = insertfields & ",cus_typeofsample"
                insertvalues = insertvalues & ",'" & cus_typeofsample.Text.Replace("'", "''") & "'"
                insertfields = insertfields & ",cus_typeoftest"
                insertvalues = insertvalues & ",'" & cus_typeoftest.Text.Replace("'", "''") & "'"
                insertfields = insertfields & ",cus_amount"
                insertvalues = insertvalues & "," & cus_amount.Text.Replace("'", "''") & ""
                insertfields = insertfields & ",cus_duration"
                insertvalues = insertvalues & ",'" & cus_duration.Text.Replace("'", "''") & "'"
                insertfields = insertfields & ",cus_remarks"
                insertvalues = insertvalues & ",'" & cus_remarks.Text.Replace("'", "''") & "'"
                insertfields = insertfields & ",cus_refno"
                insertvalues = insertvalues & ",'" & cus_refno.Text.Replace("'", "''") & "'"
                insertfields = insertfields & ",cus_createby"
                insertvalues = insertvalues & ",'" & WebLib.LoginUser.replace("'", "''") & "'"
                insertfields = insertfields & ",cus_createdt"
                insertvalues = insertvalues & ",getdate()"
                insertfields = insertfields & ",cus_updateby"
                insertvalues = insertvalues & ",'" & WebLib.LoginUser.replace("'", "''") & "'"
                insertfields = insertfields & ",cus_updatedt"
                insertvalues = insertvalues & ",getdate()"
            Else
                insertvalues = insertvalues & "cus_updateby='" & WebLib.LoginUser.replace("'", "''") & "'"
                insertvalues = insertvalues & ",cus_updatedt=getdate()"
                insertvalues = insertvalues & ",cus_company='" & cus_company.Text.Replace("'", "''") & "'"
                insertvalues = insertvalues & ",cus_name='" & cus_name.Text.Replace("'", "''") & "'"
                insertvalues = insertvalues & ",cus_salesexec='" & cus_salesexec.Text.Replace("'", "''") & "'"
                insertvalues = insertvalues & ",cus_contactno='" & cus_contactno.Text.Replace("'", "''") & "'"
                insertvalues = insertvalues & ",cus_email='" & cus_email.Text.Replace("'", "''") & "'"
                insertvalues = insertvalues & ",cus_address='" & cus_address.Text.Replace("'", "''") & "'"
                insertvalues = insertvalues & ",cus_typeofsample='" & cus_typeofsample.Text.Replace("'", "''") & "'"
                insertvalues = insertvalues & ",cus_amount=" & cus_amount.Text.Replace("'", "''") & ""
                insertvalues = insertvalues & ",cus_typeoftest='" & cus_typeoftest.Text.Replace("'", "''") & "'"
                insertvalues = insertvalues & ",cus_duration='" & cus_duration.Text.Replace("'", "''") & "'"
                insertvalues = insertvalues & ",cus_remarks='" & cus_remarks.Text.Replace("'", "''") & "'"
            End If

            If savedata(insertfields, insertvalues, True, lsql) = True Then
                Dim lid As String = ViFeandi.General.GetValue(connectionstring, TableName, "cus_id", "cus_ucode", "'" & ucode.Value & "'", "cus_merchantid", WebLib.MerchantID, "cus_filter", WebLib.FilterCode)
                Response.Redirect("postpage.aspx?NextPage=" & WebLib.ClientURL("modules/custom/cussamples.aspx") & "&ga=" & lid)
            End If
        Catch Err As Exception
            lblmessage.Text = WebLib.getAlertMessageStyle(Err.Message)
        Finally

        End Try

    End Sub
End Class

