Imports System.IO
Imports System.Data
Imports System.Data.SqlClient
Imports System.Data.OleDb
Imports System.Web
Imports System.Web.UI
Imports System.Web.UI.WebControls
Partial Public Class docrepomod_class
    Inherits listpage
    'Generated by VI FEANDI SOFTLABS FORM GENERATOR (http://www.vifeandi.net) VER 2014.1
    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        _searchkeystr = ""
        listingpage = ""
        _FormsName = "Document Repository"
        columnscount = "10"
        TableName = ""
        DetailPage = "docdocmod.aspx"
        IDPField = ""
        IDField = "dg_id"
        AppIDField = ""
        MerchantIDField = ""
        FilterField = ""
        _pagesize = 20
        APPCode = "" '"SMS"
        AddRights = "" '"SM0001"
        DelRights = "" ' "SM0003"
        ModRights = "" '"SM0002"
        ViewRights = "" '"SM0004"
        FullRights = ""
        NmSpace = "docdocmod"
        pFieldNames = ""
        pJoinFields = ""
        Orderby = ""


        '        If WebLib.PrevURL.trim = "" Then
        'lblMessage.Text = "Inconsistency detected. Unable to upload document."
        'btnadd.Enabled = False
        'Exit Sub
        'End If

        If Page.IsPostBack = False Then
            da.value = Request("da")
        End If
        Call InitLoad()
        Call loaddoc(" doc_uniqueid='" & bid.Value & "'")

        btnadd.visible = True
    End Sub
    Private Sub loaddoc(Optional ByVal _p_searchkey As String = "")

        Dim cn As New OleDbConnection(connectionstring)

        Dim cmd As New OleDbCommand()
        Dim ad As New OleDb.OleDbDataAdapter()
        Dim ds As New DataSet()
        Dim counter As Integer = 0
        Dim dr As DataRow

        If _p_searchkey.Trim <> "" Then
            _p_searchkey = " and " & _p_searchkey
        End If

        mode.value = "D"
        nmtitle.InnerHtml = "Attachment"

        cn.Open()
        cmd.CommandText = "Select docdoc.*,dg_name,dg_id from docdoc left outer join docgroup on doc_group = dg_id where isnull(doc_group,0) = -1 " & _p_searchkey & " order by doc_subject"

        cmd.Connection = cn
        ad.SelectCommand = cmd
        ad.Fill(ds, "datarecords")
        Dim dt As DataTable = ds.Tables("datarecords")
        Dim dv As New DataView(dt)
        Dim pgitems As New PagedDataSource()
        pgitems.DataSource = dv

        rep.DataSource = pgitems
        rep.DataBind()

    End Sub
    Protected Sub rep_ItemCommand(ByVal source As Object, ByVal e As System.Web.UI.WebControls.RepeaterCommandEventArgs) Handles rep.ItemCommand

    End Sub

    Protected Sub rep_ItemDataBound(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.RepeaterItemEventArgs) Handles rep.ItemDataBound

        Dim drv As DataRowView
        drv = e.Item.DataItem

        Dim objdata As Literal = e.Item.FindControl("litData")

        If objdata Is Nothing Then
            Exit Sub
        End If

        objdata.Visible = True

        Dim lhead As String = ""
        If drv.Row("doc_attach1").ToString.Trim <> "" Then
            lhead = "<a href=""#"" onClick=""$.colorbox({iframe:true,opacity:0.5,trapFocus:true,href: '" & WebLib.ClientURL(drv.Row("doc_attach1path").ToString.Trim & drv.Row("doc_attach1").ToString.Trim) & "',width:'90%',height:'90%'})"">" & drv.Row("doc_subject").ToString.Trim & "</a>"
        Else
            lhead = "<b>" & drv.Row("doc_subject").ToString.Trim & "</b>"
        End If
        objdata.Text = lhead & "<br><font color=""gray"">" & drv.Row("doc_details").ToString.Trim & "<br>Uploaded On: " & drv.Row("doc_createdt").ToString.Trim & " by " & drv.Row("doc_createby").ToString.Trim & "</font>"
        objdata = e.Item.FindControl("litimage")
        Dim obj As New clsFileTypes
        obj.InitFile(drv.Row("doc_attach1").ToString.Trim)
        If Not objdata Is Nothing Then
            objdata.Text = "<img src=""" & WebLib.ClientURL(obj.FileImageFile) & """ width=""64"">"
        End If
        obj = Nothing


    End Sub
    Public Sub redirecttonext(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Response.Redirect("postpage.aspx?NextPage=docdocmod.aspx&da=" & da.Value & " &ba=" & bid.Value)
    End Sub
    Public Sub backpage2(ByVal sender As System.Object, ByVal e As System.EventArgs)

        Dim lid As String = ViFeandi.General.GetValue(connectionstring, "workflowstatus", "wst_module", "wst_ucode", "'" & bid.Value & "'", "", WebLib.MerchantID, "", WebLib.FilterCode)
        Dim lURL As String = ""
        lURL = Redirector.Redirect(lid, bid.Value) & ""
        If lURL.Trim = "" Then
            Response.Redirect("~/main.aspx")
        Else
            Response.Redirect("~/" & lURL)

        End If


    End Sub

End Class

